<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lịch Học Chuyên Nghiệp</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
        }
        h1 {
            text-align: center;
            color: #333;
            cursor: pointer;
            padding: 10px;
            border: 1px solid transparent;
        }
        h1:hover {
            border: 1px dashed #ddd;
        }
        .schedule {
            max-width: 1200px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
            font-size: 14px;
            vertical-align: top;
        }
        th {
            background-color: #4CAF50;
            color: white;
        }
        td {
            background-color: #fafafa;
            cursor: pointer;
            max-height: 100px;
            overflow-y: auto;
        }
        td:empty {
            background-color: #f0f0f0;
        }
        .course {
            font-weight: bold;
            color: #2c3e50;
        }
        .edit-input, .edit-textarea {
            width: 100%;
            box-sizing: border-box;
            padding: 5px;
            font-size: 14px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .edit-textarea {
            height: 80px;
            resize: vertical;
        }
        .save-button {
            margin-top: 5px;
            padding: 5px 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .save-button:hover {
            background-color: #45a049;
        }
        .title-container {
            position: relative;
            display: inline-block;
        }
        @media (max-width: 768px) {
            table, th, td {
                font-size: 12px;
                padding: 8px;
            }
            .edit-textarea {
                height: 60px;
            }
            h1 {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <div class="title-container">
        <h1 id="scheduleTitle">Lịch Học Chuyên Nghiệp - Tuần 1</h1>
    </div>
    <div class="schedule">
        <table id="scheduleTable">
            <tr>
                <th>Thời gian</th>
                <th>Thứ Hai</th>
                <th>Thứ Ba</th>
                <th>Thứ Tư</th>
                <th>Thứ Năm</th>
                <th>Thứ Sáu</th>
            </tr>
            <tr>
                <td>08:30 - 10:00</td>
                <td class="course">Lập trình Python<br>Giáo viên: Nguyễn Văn A<br>Phòng: A101<br>Ghi chú: Mang laptop</td>
                <td></td>
                <td class="course">Phát triển Web<br>Giáo viên: Trần Thị B<br>Phòng: B204<br>Ghi chú: Chuẩn bị dự án</td>
                <td class="course">Cơ sở dữ liệu<br>Giáo viên: Lê Văn C<br>Phòng: A102<br>Ghi chú: Ôn bài SQL</td>
                <td class="course">Kiểm thử phần mềm<br>Giáo viên: Phạm Thị D<br>Phòng: C301<br>Ghi chú: Bài tập nhóm</td>
            </tr>
            <tr>
                <td>10:30 - 12:00</td>
                <td></td>
                <td class="course">Thiết kế UI/UX<br>Giáo viên: Hoàng Văn E<br>Phòng: B205<br>Ghi chú: Cài Figma</td>
                <td class="course">Lập trình JavaScript<br>Giáo viên: Nguyễn Văn F<br>Phòng: A103<br>Ghi chú: Học ES6</td>
                <td></td>
                <td class="course">Quản lý dự án<br>Giáo viên: Trần Văn G<br>Phòng: C302<br>Ghi chú: Thảo luận Agile</td>
            </tr>
            <tr>
                <td>13:15 - 14:45</td>
                <td class="course">Cơ sở dữ liệu<br>Giáo viên: Lê Văn C<br>Phòng: A102<br>Ghi chú: Thực hành NoSQL</td>
                <td class="course">Lập trình Python<br>Giáo viên: Nguyễn Văn A<br>Phòng: A101<br>Ghi chú: Bài tập OOP</td>
                <td></td>
                <td class="course">Phát triển Web<br>Giáo viên: Trần Thị B<br>Phòng: B204<br>Ghi chú: HTML/CSS nâng cao</td>
                <td></td>
            </tr>
            <tr>
                <td>15:15 - 16:00</td>
                <td class="course">Kiểm thử phần mềm<br>Giáo viên: Phạm Thị D<br>Phòng: C301<br>Ghi chú: Kiểm thử tự động</td>
                <td></td>
                <td class="course">Thiết kế UI/UX<br>Giáo viên: Hoàng Văn E<br>Phòng: B205<br>Ghi chú: Dự án cuối kỳ</td>
                <td class="course">Lập trình JavaScript<br>Giáo viên: Nguyễn Văn F<br>Phòng: A103<br>Ghi chú: Học React</td>
                <td></td>
            </tr>
        </table>
    </div>

     <h1 id="scheduleTitle">Lịch Học Chuyên Nghiệp - Tuần 1</h1>
    </div>
    <div class="schedule">
        <table id="scheduleTable">
            <tr>
                <th>Thời gian</th>
                <th>Thứ Hai</th>
                <th>Thứ Ba</th>
                <th>Thứ Tư</th>
                <th>Thứ Năm</th>
                <th>Thứ Sáu</th>
            </tr>
            <tr>
                <td>08:30 - 10:00</td>
                <td class="course">Lập trình Python<br>Giáo viên: Nguyễn Văn A<br>Phòng: A101<br>Ghi chú: Mang laptop</td>
                <td></td>
                <td class="course">Phát triển Web<br>Giáo viên: Trần Thị B<br>Phòng: B204<br>Ghi chú: Chuẩn bị dự án</td>
                <td class="course">Cơ sở dữ liệu<br>Giáo viên: Lê Văn C<br>Phòng: A102<br>Ghi chú: Ôn bài SQL</td>
                <td class="course">Kiểm thử phần mềm<br>Giáo viên: Phạm Thị D<br>Phòng: C301<br>Ghi chú: Bài tập nhóm</td>
            </tr>
            <tr>
                <td>10:30 - 12:00</td>
                <td></td>
                <td class="course">Thiết kế UI/UX<br>Giáo viên: Hoàng Văn E<br>Phòng: B205<br>Ghi chú: Cài Figma</td>
                <td class="course">Lập trình JavaScript<br>Giáo viên: Nguyễn Văn F<br>Phòng: A103<br>Ghi chú: Học ES6</td>
                <td></td>
                <td class="course">Quản lý dự án<br>Giáo viên: Trần Văn G<br>Phòng: C302<br>Ghi chú: Thảo luận Agile</td>
            </tr>
            <tr>
                <td>13:15 - 14:45</td>
                <td class="course">Cơ sở dữ liệu<br>Giáo viên: Lê Văn C<br>Phòng: A102<br>Ghi chú: Thực hành NoSQL</td>
                <td class="course">Lập trình Python<br>Giáo viên: Nguyễn Văn A<br>Phòng: A101<br>Ghi chú: Bài tập OOP</td>
                <td></td>
                <td class="course">Phát triển Web<br>Giáo viên: Trần Thị B<br>Phòng: B204<br>Ghi chú: HTML/CSS nâng cao</td>
                <td></td>
            </tr>
            <tr>
                <td>15:15 - 16:00</td>
                <td class="course">Kiểm thử phần mềm<br>Giáo viên: Phạm Thị D<br>Phòng: C301<br>Ghi chú: Kiểm thử tự động</td>
                <td></td>
                <td class="course">Thiết kế UI/UX<br>Giáo viên: Hoàng Văn E<br>Phòng: B205<br>Ghi chú: Dự án cuối kỳ</td>
                <td class="course">Lập trình JavaScript<br>Giáo viên: Nguyễn Văn F<br>Phòng: A103<br>Ghi chú: Học React</td>
                <td></td>
            </tr>
        </table>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Import Firebase modular SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
        import { getFirestore, collection, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAfy4QMD9_7PyFHpInNdKDRWuW4AYCtLJ4",
            authDomain: "history-e4633.firebaseapp.com",
            projectId: "history-e4633",
            storageBucket: "history-e4633.firebasestorage.app",
            messagingSenderId: "331974436893",
            appId: "1:331974436893:web:10c3c6adf7b66d2b5fbef4",
            measurementId: "G-DC055090BW"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Load schedule from Firestore
        async function loadSchedule() {
            try {
                // Load title
                const titleRef = doc(db, "lichhoc", "title");
                const titleDoc = await getDoc(titleRef);
                if (titleDoc.exists()) {
                    document.getElementById("scheduleTitle").textContent = titleDoc.data().value || "Lịch Học Chuyên Nghiệp - Tuần 1";
                }

                // Load table cells
                const table = document.getElementById("scheduleTable");
                for (let i = 1; i < table.rows.length; i++) {
                    const rowRef = doc(db, "lichhoc", "schedule", "rows", i.toString());
                    const rowDoc = await getDoc(rowRef);
                    if (rowDoc.exists()) {
                        const cells = rowDoc.data();
                        for (let j = 0; j < table.rows[i].cells.length; j++) {
                            const content = cells[j] || "";
                            table.rows[i].cells[j].innerHTML = content.replace(/\n/g, "<br>");
                            table.rows[i].cells[j].className = content && j !== 0 ? "course" : "";
                        }
                    }
                }
            } catch (error) {
                console.error("Error loading schedule:", error);
                alert("Không thể tải lịch học từ Firestore.");
            }
        }

        // Edit table cell
        function editCell(event) {
            const cell = event.target;
            if (cell.tagName !== "TD") return;

            // Prevent multiple edits
            if (cell.querySelector("input") || cell.querySelector("textarea")) return;

            const isTimeCell = cell.cellIndex === 0;
            const originalContent = cell.innerHTML.replace(/<br\s*\/?>/gi, "\n");
            cell.innerHTML = "";

            // Create input or textarea based on cell type
            const inputElement = isTimeCell
                ? document.createElement("input")
                : document.createElement("textarea");
            inputElement.className = isTimeCell ? "edit-input" : "edit-textarea";
            inputElement.value = originalContent;
            cell.appendChild(inputElement);

            // Create save button
            const saveButton = document.createElement("button");
            saveButton.className = "save-button";
            saveButton.textContent = "Lưu";
            saveButton.onclick = () => saveCell(cell, inputElement, isTimeCell);
            cell.appendChild(saveButton);

            inputElement.focus();
        }

        async function saveCell(cell, inputElement, isTimeCell) {
            const newContent = inputElement.value.trim();
            try {
                // Save to Firestore
                const rowIndex = cell.parentNode.rowIndex;
                const cellIndex = cell.cellIndex;
                const rowRef = doc(db, "lichhoc", "schedule", "rows", rowIndex.toString());
                await setDoc(rowRef, { [cellIndex]: newContent }, { merge: true });

                // Update UI
                cell.innerHTML = newContent.replace(/\n/g, "<br>");
                cell.className = newContent && !isTimeCell ? "course" : "";
            } catch (error) {
                console.error("Error saving cell:", error);
                alert("Không thể lưu thay đổi vào Firestore.");
            }
        }

        // Edit title
        function editTitle(event) {
            const title = event.target;
            if (title.tagName !== "H1") return;

            // Prevent multiple edits
            if (title.querySelector("input")) return;

            const originalContent = title.textContent;
            title.innerHTML = "";

            // Create input for title
            const inputElement = document.createElement("input");
            inputElement.className = "edit-input";
            inputElement.value = originalContent;
            inputElement.style.width = "80%";
            title.appendChild(inputElement);

            // Create save button
            const saveButton = document.createElement("button");
            saveButton.className = "save-button";
            saveButton.textContent = "Lưu";
            saveButton.onclick = () => saveTitle(title, inputElement);
            title.appendChild(saveButton);

            inputElement.focus();
        }

        async function saveTitle(title, inputElement) {
            const newContent = inputElement.value.trim() || "Lịch Học Chuyên Nghiệp - Tuần 1";
            try {
                // Save to Firestore
                const titleRef = doc(db, "lichhoc", "title");
                await setDoc(titleRef, { value: newContent });

                // Update UI
                title.textContent = newContent;
            } catch (error) {
                console.error("Error saving title:", error);
                alert("Không thể lưu tiêu đề vào Firestore.");
            }
        }

        // Add event listeners
        document.getElementById("scheduleTable").addEventListener("click", editCell);
        document.getElementById("scheduleTitle").addEventListener("click", editTitle);

        // Load schedule on page load
        document.addEventListener("DOMContentLoaded", loadSchedule);
    </script>
</body>
</html>
